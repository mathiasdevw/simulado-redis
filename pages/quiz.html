<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Simulado Redis — Prova 31/10/2025</title>
  <style>
    :root{--bg:#2e003e;--card:#6a1b9a;--accent:#ba68c8;--text:#ffffff}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#03131a);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{width:900px;max-width:100%;background:var(--card);border-radius:14px;padding:28px;box-shadow:0 10px 30px rgba(2,10,20,.6);max-height:80vh;overflow-y:auto}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px;color:var(--accent)}
    p.lead{margin:6px 0 18px;color:#bfeaf9}
    .progress-bar{width:200px;height:8px;background:rgba(255,255,255,0.2);border-radius:4px;margin-right:10px}
    .progress-fill{height:100%;background:var(--accent);border-radius:4px;width:0%;transition:width 0.3s}
    .q{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px;margin-bottom:12px;display:none}
    .q.active{display:block}
    .q h3{margin:0 0 8px;font-size:15px}
    label{display:block;margin:6px 0;cursor:pointer}
    input[type=text],textarea{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
    .actions{display:flex;gap:10px;align-items:center;margin-top:12px}
    button{background:var(--accent);border:0;color:#00262b;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    .result{margin-top:16px;background:linear-gradient(180deg,rgba(0,0,0,.12),rgba(255,255,255,0.02));padding:12px;border-radius:8px}
    .correct{color:#9ff1b0}
    .wrong{color:#ff9aa2}
    .explain{font-size:13px;color:#cfeef9;margin-top:6px}
    footer{margin-top:16px;text-align:right;color:#8fcfe9;font-size:13px}
    .badge{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;font-weight:700;color:var(--accent)}
    @media(max-width:640px){.container{padding:14px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Simulado Redis — 30 Questões</h1>
        <p class="lead">Responda 30 questões. No final você verá pontuação, respostas corretas e explicações.</p>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <div class="badge">Questão 1 / 30</div>
    </header>

    <div id="name-screen">
      <h2>Insira seu nome para começar o simulado</h2>
      <input type="text" id="user-name" placeholder="Seu nome" maxlength="50">
      <button id="start-quiz">Começar Simulado</button>
    </div>

    <form id="quiz" style="display:none">

      <!-- Q1: String commands multiple choice -->
      <section class="q active" data-q="1">
        <h3>1) (Strings) Qual comando do Redis você usa para definir o tempo de vida (TTL) de uma chave?</h3>
        <label><input type="radio" name="q1" value="A"> A) SETEX</label>
        <label><input type="radio" name="q1" value="B"> B) EXPIRE</label>
        <label><input type="radio" name="q1" value="C"> C) TTLSET</label>
        <label><input type="radio" name="q1" value="D"> D) PERSIST</label>
      </section>

      <!-- Q2: List operations -->
      <section class="q" data-q="2">
        <h3>2) (Lists) Qual sequência de comandos implementa uma fila FIFO usando listas Redis?</h3>
        <label><input type="radio" name="q2" value="A"> A) LPUSH + LPOP</label>
        <label><input type="radio" name="q2" value="B"> B) RPUSH + LPOP</label>
        <label><input type="radio" name="q2" value="C"> C) LPUSH + RPOP</label>
        <label><input type="radio" name="q2" value="D"> D) RPUSH + RPOP</label>
      </section>

      <!-- Q3: Sets: conceptual -->
      <section class="q" data-q="3">
        <h3>3) (Sets) Sobre <code>SMEMBERS</code> e <code>SISMEMBER</code>, qual afirmação é verdadeira?</h3>
        <label><input type="radio" name="q3" value="A"> A) SMEMBERS retorna quantidade, SISMEMBER retorna boolean</label>
        <label><input type="radio" name="q3" value="B"> B) SMEMBERS retorna todos os membros do set, SISMEMBER verifica se um valor pertence ao set</label>
        <label><input type="radio" name="q3" value="C"> C) SISMEMBER retorna todos os membros, SMEMBERS verifica existência</label>
        <label><input type="radio" name="q3" value="D"> D) Ambos retornam boolean</label>
      </section>

      <!-- Q4: Sorted Set commands -->
      <section class="q" data-q="4">
        <h3>4) (ZSet) Qual comando retorna os elementos de um sorted set em ordem decrescente de score?</h3>
        <label><input type="radio" name="q4" value="A"> A) ZRANGE</label>
        <label><input type="radio" name="q4" value="B"> B) ZREVRANGE</label>
        <label><input type="radio" name="q4" value="C"> C) ZRANK</label>
        <label><input type="radio" name="q4" value="D"> D) ZSCORE</label>
      </section>

      <!-- Q5: Strings - SET (text input) -->
      <section class="q" data-q="5">
        <h3>5) (Strings) Digite o comando para definir o valor de uma chave string no Redis (ex: SET key value)</h3>
        <input type="text" name="q5" placeholder="Digite o comando">
      </section>

      <!-- Q6: Strings - DEL -->
      <section class="q" data-q="6">
        <h3>6) (Strings) Qual comando remove uma chave do Redis?</h3>
        <label><input type="radio" name="q6" value="A"> A) SET</label>
        <label><input type="radio" name="q6" value="B"> B) GET</label>
        <label><input type="radio" name="q6" value="C"> C) DEL</label>
        <label><input type="radio" name="q6" value="D"> D) EXPIRE</label>
      </section>

      <!-- Q7: Strings - INCR -->
      <section class="q" data-q="7">
        <h3>7) (Strings) Qual comando incrementa o valor numérico de uma chave string em 1?</h3>
        <label><input type="radio" name="q7" value="A"> A) DECR</label>
        <label><input type="radio" name="q7" value="B"> B) INCR</label>
        <label><input type="radio" name="q7" value="C"> C) STRLEN</label>
        <label><input type="radio" name="q7" value="D"> D) SET</label>
      </section>

      <!-- Q8: Strings - DECR -->
      <section class="q" data-q="8">
        <h3>8) (Strings) Qual comando decrementa o valor numérico de uma chave string em 1?</h3>
        <label><input type="radio" name="q8" value="A"> A) INCR</label>
        <label><input type="radio" name="q8" value="B"> B) DECR</label>
        <label><input type="radio" name="q8" value="C"> C) EXPIRE</label>
        <label><input type="radio" name="q8" value="D"> D) STRLEN</label>
      </section>

      <!-- Q9: Strings - EXPIRE -->
      <section class="q" data-q="9">
        <h3>9) (Strings) Qual comando define o tempo de vida (TTL) de uma chave?</h3>
        <label><input type="radio" name="q9" value="A"> A) SETEX</label>
        <label><input type="radio" name="q9" value="B"> B) EXPIRE</label>
        <label><input type="radio" name="q9" value="C"> C) TTLSET</label>
        <label><input type="radio" name="q9" value="D"> D) PERSIST</label>
      </section>

      <!-- Q10: Strings - STRLEN (text input) -->
      <section class="q" data-q="10">
        <h3>10) (Strings) Digite o comando para retornar o comprimento de uma string (ex: STRLEN key)</h3>
        <input type="text" name="q10" placeholder="Digite o comando">
      </section>

      <!-- Q11: Lists - LPUSH -->
      <section class="q" data-q="11">
        <h3>11) (Lists) Qual comando adiciona um ou mais elementos no início de uma lista?</h3>
        <label><input type="radio" name="q11" value="A"> A) RPUSH</label>
        <label><input type="radio" name="q11" value="B"> B) LPUSH</label>
        <label><input type="radio" name="q11" value="C"> C) LPOP</label>
        <label><input type="radio" name="q11" value="D"> D) RPOP</label>
      </section>

      <!-- Q12: Lists - RPUSH -->
      <section class="q" data-q="12">
        <h3>12) (Lists) Qual comando adiciona um ou mais elementos no final de uma lista?</h3>
        <label><input type="radio" name="q12" value="A"> A) LPUSH</label>
        <label><input type="radio" name="q12" value="B"> B) RPUSH</label>
        <label><input type="radio" name="q12" value="C"> C) LPOP</label>
        <label><input type="radio" name="q12" value="D"> D) RPOP</label>
      </section>

      <!-- Q13: Lists - LPOP -->
      <section class="q" data-q="13">
        <h3>13) (Lists) Qual comando remove e retorna o primeiro elemento de uma lista?</h3>
        <label><input type="radio" name="q13" value="A"> A) RPUSH</label>
        <label><input type="radio" name="q13" value="B"> B) LPOP</label>
        <label><input type="radio" name="q13" value="C"> C) RPOP</label>
        <label><input type="radio" name="q13" value="D"> D) LRANGE</label>
      </section>

      <!-- Q14: Lists - RPOP -->
      <section class="q" data-q="14">
        <h3>14) (Lists) Qual comando remove e retorna o último elemento de uma lista?</h3>
        <label><input type="radio" name="q14" value="A"> A) LPUSH</label>
        <label><input type="radio" name="q14" value="B"> B) RPOP</label>
        <label><input type="radio" name="q14" value="C"> C) LPOP</label>
        <label><input type="radio" name="q14" value="D"> D) LLEN</label>
      </section>

      <!-- Q15: Lists - LRANGE (text input) -->
      <section class="q" data-q="15">
        <h3>15) (Lists) Digite o comando para retornar um subconjunto de elementos de uma lista (ex: LRANGE key start stop)</h3>
        <input type="text" name="q15" placeholder="Digite o comando">
      </section>

      <!-- Q16: Lists - LLEN -->
      <section class="q" data-q="16">
        <h3>16) (Lists) Qual comando retorna o número de elementos em uma lista?</h3>
        <label><input type="radio" name="q16" value="A"> A) LRANGE</label>
        <label><input type="radio" name="q16" value="B"> B) LLEN</label>
        <label><input type="radio" name="q16" value="C"> C) LTRIM</label>
        <label><input type="radio" name="q16" value="D"> D) LINDEX</label>
      </section>

      <!-- Q17: Lists - LREM -->
      <section class="q" data-q="17">
        <h3>17) (Lists) Qual comando remove elementos iguais a um valor específico de uma lista?</h3>
        <label><input type="radio" name="q17" value="A"> A) LTRIM</label>
        <label><input type="radio" name="q17" value="B"> B) LREM</label>
        <label><input type="radio" name="q17" value="C"> C) LINDEX</label>
        <label><input type="radio" name="q17" value="D"> D) LLEN</label>
      </section>

      <!-- Q18: Lists - LTRIM -->
      <section class="q" data-q="18">
        <h3>18) (Lists) Qual comando mantém apenas um subconjunto de elementos em uma lista?</h3>
        <label><input type="radio" name="q18" value="A"> A) LREM</label>
        <label><input type="radio" name="q18" value="B"> B) LTRIM</label>
        <label><input type="radio" name="q18" value="C"> C) LRANGE</label>
        <label><input type="radio" name="q18" value="D"> D) LPOP</label>
      </section>

      <!-- Q19: Lists - LINDEX -->
      <section class="q" data-q="19">
        <h3>19) (Lists) Qual comando retorna o elemento em uma posição específica de uma lista?</h3>
        <label><input type="radio" name="q19" value="A"> A) LRANGE</label>
        <label><input type="radio" name="q19" value="B"> B) LINDEX</label>
        <label><input type="radio" name="q19" value="C"> C) LLEN</label>
        <label><input type="radio" name="q19" value="D"> D) LREM</label>
      </section>

      <!-- Q20: Sets - SADD (text input) -->
      <section class="q" data-q="20">
        <h3>20) (Sets) Digite o comando para adicionar um ou mais membros a um conjunto (ex: SADD key member)</h3>
        <input type="text" name="q20" placeholder="Digite o comando">
      </section>

      <!-- Q21: Sets - SREM -->
      <section class="q" data-q="21">
        <h3>21) (Sets) Qual comando remove um ou mais membros de um conjunto?</h3>
        <label><input type="radio" name="q21" value="A"> A) SADD</label>
        <label><input type="radio" name="q21" value="B"> B) SREM</label>
        <label><input type="radio" name="q21" value="C"> C) SCARD</label>
        <label><input type="radio" name="q21" value="D"> D) SUNION</label>
      </section>

      <!-- Q22: Sets - SMEMBERS -->
      <section class="q" data-q="22">
        <h3>22) (Sets) Qual comando retorna todos os membros de um conjunto?</h3>
        <label><input type="radio" name="q22" value="A"> A) SISMEMBER</label>
        <label><input type="radio" name="q22" value="B"> B) SMEMBERS</label>
        <label><input type="radio" name="q22" value="C"> C) SCARD</label>
        <label><input type="radio" name="q22" value="D"> D) SINTER</label>
      </section>

      <!-- Q23: Sets - SISMEMBER -->
      <section class="q" data-q="23">
        <h3>23) (Sets) Qual comando verifica se um valor é membro de um conjunto?</h3>
        <label><input type="radio" name="q23" value="A"> A) SMEMBERS</label>
        <label><input type="radio" name="q23" value="B"> B) SISMEMBER</label>
        <label><input type="radio" name="q23" value="C"> C) SCARD</label>
        <label><input type="radio" name="q23" value="D"> D) SDIFF</label>
      </section>

      <!-- Q24: Sets - SCARD -->
      <section class="q" data-q="24">
        <h3>24) (Sets) Qual comando retorna o número de membros em um conjunto?</h3>
        <label><input type="radio" name="q24" value="A"> A) SMEMBERS</label>
        <label><input type="radio" name="q24" value="B"> B) SCARD</label>
        <label><input type="radio" name="q24" value="C"> C) SISMEMBER</label>
        <label><input type="radio" name="q24" value="D"> D) SMOVE</label>
      </section>

      <!-- Q25: Sets - SUNION (text input) -->
      <section class="q" data-q="25">
        <h3>25) (Sets) Digite o comando para retornar a união de dois ou mais conjuntos (ex: SUNION key1 key2)</h3>
        <input type="text" name="q25" placeholder="Digite o comando">
      </section>

      <!-- Q26: Sets - SINTER -->
      <section class="q" data-q="26">
        <h3>26) (Sets) Qual comando retorna a interseção de dois ou mais conjuntos?</h3>
        <label><input type="radio" name="q26" value="A"> A) SUNION</label>
        <label><input type="radio" name="q26" value="B"> B) SINTER</label>
        <label><input type="radio" name="q26" value="C"> C) SDIFF</label>
        <label><input type="radio" name="q26" value="D"> D) SCARD</label>
      </section>

      <!-- Q27: Sets - SDIFF -->
      <section class="q" data-q="27">
        <h3>27) (Sets) Qual comando retorna a diferença entre dois ou mais conjuntos?</h3>
        <label><input type="radio" name="q27" value="A"> A) SINTER</label>
        <label><input type="radio" name="q27" value="B"> B) SDIFF</label>
        <label><input type="radio" name="q27" value="C"> C) SUNION</label>
        <label><input type="radio" name="q27" value="D"> D) SMOVE</label>
      </section>

      <!-- Q28: Sets - SMOVE -->
      <section class="q" data-q="28">
        <h3>28) (Sets) Qual comando move um membro de um conjunto para outro?</h3>
        <label><input type="radio" name="q28" value="A"> A) SADD</label>
        <label><input type="radio" name="q28" value="B"> B) SMOVE</label>
        <label><input type="radio" name="q28" value="C"> C) SREM</label>
        <label><input type="radio" name="q28" value="D"> D) SCARD</label>
      </section>

      <!-- Q29: ZSet - ZADD -->
      <section class="q" data-q="29">
        <h3>29) (ZSet) Qual comando adiciona um ou mais membros com scores a um sorted set?</h3>
        <label><input type="radio" name="q29" value="A"> A) ZREM</label>
        <label><input type="radio" name="q29" value="B"> B) ZADD</label>
        <label><input type="radio" name="q29" value="C"> C) ZRANGE</label>
        <label><input type="radio" name="q29" value="D"> D) ZRANK</label>
      </section>

      <!-- Q30: ZSet - ZREM (text input) -->
      <section class="q" data-q="30">
        <h3>30) (ZSet) Digite o comando para remover um ou mais membros de um sorted set (ex: ZREM key member)</h3>
        <input type="text" name="q30" placeholder="Digite o comando">
      </section>

      <div class="actions">
        <button type="button" id="prev" style="display:none">Anterior</button>
        <button type="button" id="check">Verificar Resposta</button>
        <button type="button" id="skip">Pular</button>
        <button type="button" id="hint">Dica</button>
        <button type="button" id="next">Próxima</button>
        <div style="flex:1"></div>
        <div id="timer" style="color:#99e6ff;font-weight:700">30s</div>
      </div>

    </form>

    <div id="output" class="result" style="display:none"></div>

    <div id="final-screen" style="display:none">
      <h2>Resultado Final</h2>
      <p id="final-score"></p>
      <button id="submit-score">Enviar Pontuação</button>
      <button id="export-pdf">Exportar PDF</button>
      <div id="submit-status"></div>
    </div>

    <footer>Formato: 5 questões — levar caneta e papel — <strong>Laboratório 2</strong></footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const supabaseUrl = 'https://cptjkajmrsftwuxcysoe.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNwdGprYWptcnNmdHd1eGN5c29lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MjY0OTgsImV4cCI6MjA3NzUwMjQ5OH0.6nVpZSAVhrThZrDcWfJnZJtcImDv78n9VhPYljsFUH0';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    let userName = '';
    let questionOrder = [];
    let currentQuestionIndex = 0;
    const totalQuestions = 30;
    let answers = {};
    let checked = {};
    let skipped = {};
    let timerInterval;
    let timeLeft = 30;

    const correct = {
      q1: 'B', // EXPIRE
      q2: 'B', // RPUSH + LPOP
      q3: 'B', // SMEMBERS returns members; SISMEMBER checks membership
      q4: 'B', // ZREVRANGE
      q5: 'SET', // text
      q6: 'C', // DEL
      q7: 'B', // INCR
      q8: 'B', // DECR
      q9: 'B', // EXPIRE
      q10: 'STRLEN', // text
      q11: 'B', // LPUSH
      q12: 'B', // RPUSH
      q13: 'B', // LPOP
      q14: 'B', // RPOP
      q15: 'LRANGE', // text
      q16: 'B', // LLEN
      q17: 'B', // LREM
      q18: 'B', // LTRIM
      q19: 'B', // LINDEX
      q20: 'SADD', // text
      q21: 'B', // SREM
      q22: 'B', // SMEMBERS
      q23: 'B', // SISMEMBER
      q24: 'B', // SCARD
      q25: 'SUNION', // text
      q26: 'B', // SINTER
      q27: 'B', // SDIFF
      q28: 'B', // SMOVE
      q29: 'B', // ZADD
      q30: 'ZREM'  // text
    };

    const explanations = {
      q1: 'EXPIRE key segundos define TTL para a chave. (OBS: SETEX define valor com TTL em um único comando.)',
      q2: 'RPUSH adiciona no final e LPOP remove do início → comportamento FIFO (First In First Out).',
      q3: 'SMEMBERS retorna todos os membros do conjunto; SISMEMBER verifica se um valor pertence ao conjunto (retorna 1 ou 0).',
      q4: 'ZREVRANGE retorna elementos do maior para o menor score; ZRANGE retorna do menor para o maior.',
      q5: 'SET key value define o valor de uma chave string.',
      q6: 'DEL key remove uma chave do Redis.',
      q7: 'INCR key incrementa o valor numérico da chave em 1.',
      q8: 'DECR key decrementa o valor numérico da chave em 1.',
      q9: 'EXPIRE key segundos define TTL para a chave.',
      q10: 'STRLEN key retorna o comprimento da string.',
      q11: 'LPUSH key value [value ...] adiciona elementos no início da lista.',
      q12: 'RPUSH key value [value ...] adiciona elementos no final da lista.',
      q13: 'LPOP key remove e retorna o primeiro elemento da lista.',
      q14: 'RPOP key remove e retorna o último elemento da lista.',
      q15: 'LRANGE key start stop retorna um subconjunto de elementos da lista.',
      q16: 'LLEN key retorna o número de elementos na lista.',
      q17: 'LREM key count value remove elementos iguais a value da lista.',
      q18: 'LTRIM key start stop mantém apenas um subconjunto de elementos na lista.',
      q19: 'LINDEX key index retorna o elemento na posição index da lista.',
      q20: 'SADD key member [member ...] adiciona membros ao conjunto.',
      q21: 'SREM key member [member ...] remove membros do conjunto.',
      q22: 'SMEMBERS key retorna todos os membros do conjunto.',
      q23: 'SISMEMBER key member verifica se member pertence ao conjunto.',
      q24: 'SCARD key retorna o número de membros no conjunto.',
      q25: 'SUNION key [key ...] retorna a união dos conjuntos.',
      q26: 'SINTER key [key ...] retorna a interseção dos conjuntos.',
      q27: 'SDIFF key [key ...] retorna a diferença entre os conjuntos.',
      q28: 'SMOVE source destination member move member de source para destination.',
      q29: 'ZADD key score member [score member ...] adiciona membros com scores ao sorted set.',
      q30: 'ZREM key member [member ...] remove membros do sorted set.'
    };

    const nameScreen = document.getElementById('name-screen');
    const quiz = document.getElementById('quiz');
    const badge = document.querySelector('.badge');
    const progressFill = document.getElementById('progress-fill');
    const output = document.getElementById('output');
    const finalScreen = document.getElementById('final-screen');
    const finalScore = document.getElementById('final-score');
    const submitBtn = document.getElementById('submit-score');
    const exportPdfBtn = document.getElementById('export-pdf');
    const submitStatus = document.getElementById('submit-status');
    const startBtn = document.getElementById('start-quiz');
    const prevBtn = document.getElementById('prev');
    const checkBtn = document.getElementById('check');
    const skipBtn = document.getElementById('skip');
    const hintBtn = document.getElementById('hint');
    const nextBtn = document.getElementById('next');
    const timerEl = document.getElementById('timer');

    function startTimer(){
      timeLeft = 30;
      timerEl.textContent = timeLeft + 's';
      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft + 's';
        if(timeLeft <= 0){
          clearInterval(timerInterval);
          nextQuestion();
        }
      }, 1000);
    }

    function stopTimer(){
      clearInterval(timerInterval);
    }

    function showQuestion(index){
      const q = questionOrder[index];
      document.querySelectorAll('.q').forEach(sec => sec.classList.remove('active'));
      document.querySelector(`[data-q="${q}"]`).classList.add('active');
      badge.textContent = `Questão ${index + 1} / ${totalQuestions}`;
      progressFill.style.width = ((index + 1) / totalQuestions * 100) + '%';
      prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
      nextBtn.textContent = index < totalQuestions - 1 ? 'Próxima' : 'Finalizar';
      output.style.display = 'none';
      startTimer();
      if(checked[q]){
        showFeedback(q);
      }
    }

    function showFeedback(q){
      const key = 'q'+q;
      const user = answers[key] || '';
      const corr = correct[key];
      const isCorrect = user.toUpperCase() === corr.toUpperCase();
      const explain = explanations[key];
      output.innerHTML = `<div style="margin-bottom:8px"><strong>Questão ${q}:</strong> ${isCorrect ? '<span class="correct">Correta</span>' : '<span class="wrong">Errada (correta: '+corr+')</span>'}<div class="explain">${explain}</div></div>`;
      output.style.display = 'block';
      // Play sound
      const audio = new Audio(isCorrect ? 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav' : 'https://www.soundjay.com/misc/sounds/fail-buzzer-01.wav');
      audio.play();
    }

    startBtn.addEventListener('click', ()=>{
      userName = document.getElementById('user-name').value.trim();
      if(!userName){
        alert('Por favor, insira seu nome.');
        return;
      }
      // Randomize question order
      questionOrder = Array.from({length: totalQuestions}, (_, i) => i + 1);
      for(let i = questionOrder.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [questionOrder[i], questionOrder[j]] = [questionOrder[j], questionOrder[i]];
      }
      nameScreen.style.display = 'none';
      quiz.style.display = 'block';
      showQuestion(0);
    });

    prevBtn.addEventListener('click', ()=>{
      if(currentQuestionIndex > 0){
        stopTimer();
        currentQuestionIndex--;
        showQuestion(currentQuestionIndex);
      }
    });

    function nextQuestion(){
      if(currentQuestionIndex < totalQuestions - 1){
        stopTimer();
        currentQuestionIndex++;
        showQuestion(currentQuestionIndex);
      } else {
        // finish quiz
        stopTimer();
        let score = 0;
        for(let i=1;i<=totalQuestions;i++){
          const key = 'q'+i;
          const user = answers[key] || '';
          if(!skipped[i] && user.toUpperCase() === correct[key].toUpperCase()) score++;
        }
        const percentage = Math.round((score / totalQuestions) * 100);
        finalScore.innerHTML = `Você acertou ${score} de ${totalQuestions} questões (${percentage}%).`;
        quiz.style.display = 'none';
        finalScreen.style.display = 'block';
      }
    }

    nextBtn.addEventListener('click', nextQuestion);

    checkBtn.addEventListener('click', ()=>{
      const q = questionOrder[currentQuestionIndex];
      const key = 'q'+q;
      const input = document.querySelector(`[data-q="${q}"] input[type="radio"]:checked`) || document.querySelector(`[data-q="${q}"] input[type="text"]`);
      answers[key] = input ? (input.type === 'radio' ? input.value : input.value.trim()) : '';
      checked[q] = true;
      showFeedback(q);
    });

    skipBtn.addEventListener('click', ()=>{
      const q = questionOrder[currentQuestionIndex];
      skipped[q] = true;
      nextQuestion();
    });

    hintBtn.addEventListener('click', ()=>{
      const q = questionOrder[currentQuestionIndex];
      alert(explanations['q'+q].split('.')[0] + '.'); // Show first sentence as hint
    });

    submitBtn.addEventListener('click', async ()=>{
      try {
        const { data, error } = await supabase.from('scores').insert([
          { name: userName, score: score, percentage: percentage, created_at: new Date().toISOString() }
        ]);
        if(error) throw error;
        submitStatus.innerHTML = '<span class="correct">Pontuação enviada com sucesso!</span>';
      } catch (err) {
        submitStatus.innerHTML = '<span class="wrong">Erro ao enviar: ' + err.message + '</span>';
      }
    });

    exportPdfBtn.addEventListener('click', ()=>{
      // Simple PDF export using jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text(`Resultado do Simulado Redis - ${userName}`, 10, 10);
      doc.text(`Pontuação: ${score} / ${totalQuestions} (${percentage}%)`, 10, 20);
      doc.save('resultado_simulado_redis.pdf');
    });
  </script>
</body>
</html>